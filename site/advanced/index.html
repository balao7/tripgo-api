<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="SkedGo Pty Ltd">
        
        <link rel="shortcut icon" href="../img/favicon.ico">

	<title>Advanced - TripGo Developer</title>

        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="..">TripGo Developer</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Advanced</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Bookings <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../bookings/overview/">Overview</a>
</li>

                        
                            
<li >
    <a href="../bookings/android/">Android SDK</a>
</li>

                        
                            
<li >
    <a href="../bookings/ios/">iOS SDK</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="..">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../bookings/overview/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/skedgo/tripgo-api">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#general">General</a></li>
        
            <li><a href="#regions-and-base-urls">Regions and base URLs</a></li>
        
            <li><a href="#mode-identifiers">Mode Identifiers</a></li>
        
    
        <li class="main "><a href="#routing">Routing</a></li>
        
            <li><a href="#single-modal-vs-multi-modal-routing">Single-modal vs. multi-modal routing</a></li>
        
            <li><a href="#trips-groups-frequencies-and-templates">Trips, groups, frequencies and templates</a></li>
        
            <li><a href="#placeholders-in-segment-templates">Placeholders in segment templates</a></li>
        
    
        <li class="main "><a href="#locations">Locations</a></li>
        
            <li><a href="#locations-cell-ids-and-hash-codes">Locations, cell IDs and hash codes</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="general">General</h1>
<h2 id="regions-and-base-urls">Regions and base URLs</h2>
<blockquote>
<p>What is the base URL of the API? What, wait... why does it depend on the region?</p>
</blockquote>
<p>The way the TripGo API currently works, the base URL for everything except the <code>regions.json</code> endpoint depends on the region: </p>
<ol>
<li>Hit <code>https://tripgo.skedgo.com/satapp/regions.json</code></li>
<li>Find the region you’re interested in, e.g., <code>UK_London</code></li>
<li>Then use a URL from that regions <code>urls</code> as the base URL for all subsequent calls: e.g., <code>https://hadron-uk-london.tripgo.skedgo.com/satapp/routing.json</code></li>
</ol>
<p>The reason for this is that we have a few servers around the globe, but not every server has every region, and if there’s an error connecting to one server, the clients can switch to the next. (If you want to be fancy, you could also ping each server and directly send requests to the server that's responding the fastest.)</p>
<p>We are currently considering to do that work server-side to make the API easier to use by just having a single base URL for all calls for all regions.</p>
<hr />
<h2 id="mode-identifiers">Mode Identifiers</h2>
<blockquote>
<p>What are all these peculiar looking strings such as <code>pt_pub</code>?</p>
</blockquote>
<h3 id="syntax">Syntax</h3>
<p>The syntax of the mode string is like this:</p>
<p><code>&lt;group&gt;_&lt;mode that makes sense to the user&gt;[_&lt;provider or fine-grained mode&gt;]</code></p>
<h3 id="list-of-groups">List of groups</h3>
<ul>
<li><code>pt_</code> is for transit which runs on schedules</li>
<li><code>ps_</code> is for taxi-like on-demand services</li>
<li><code>me_</code> is for vehicles you drive yourself</li>
<li><code>cy_</code> is for cycling</li>
<li><code>wa_</code> is for walking</li>
<li><code>in_</code> is for intercity long distance transport</li>
</ul>
<h4 id="pt_"><code>pt_</code></h4>
<ul>
<li><code>pt_pub</code> is "public transit" that is accessible to public</li>
<li><code>pt_pub_bus</code></li>
<li><code>pt_pub_train</code></li>
<li><code>pt_pub_ferry</code></li>
<li><code>pt_pub_tram</code></li>
<li><code>pt_pub_subway</code></li>
<li><code>pt_pub_monorail</code></li>
<li><code>pt_pub_cablecar</code></li>
<li><code>pt_pub_funicular</code></li>
<li><code>pt_pub_gondola</code></li>
<li><code>pt_ltd_SCHOOLBUS</code> is public transit of limited access (school buses)</li>
</ul>
<h4 id="ps_"><code>ps_</code></h4>
<ul>
<li><code>ps_tax</code> is for taxis</li>
<li><code>ps_tnc</code> is for uber and alike (TNC is California's official code for them)</li>
<li><code>ps_tnc_lyft</code></li>
<li><code>ps_tnc_sidecar</code></li>
<li><code>ps_tnc_uber</code></li>
<li><code>ps_shu</code> is for (airport) shuttles</li>
</ul>
<h4 id="me_"><code>me_</code></h4>
<ul>
<li><code>me_car</code> is for your own car</li>
<li><code>me_car-s</code> is for car sharing (like ZipCar or GoGet)</li>
<li><code>me_car-r</code> is for car rental (like Budget)</li>
<li><code>me_car-p</code> is for car pooling (like BlaBlaCar)</li>
<li><code>me_mot</code> is for your own motorbike</li>
</ul>
<hr />
<h1 id="routing">Routing</h1>
<h2 id="single-modal-vs-multi-modal-routing">Single-modal vs. multi-modal routing</h2>
<blockquote>
<p>How do I get these sweet results which combine taxis or other private transport modes with public transport?</p>
</blockquote>
<p>You need to specify multiple modes in the <code>routing.json</code> requests, e.g., by using <code>modes=pt_pub&amp;modes=ps_tax</code>. You can specify a long list of modes as the API will then return suitable combinations for any of those.</p>
<blockquote>
<p>What if I want to get both public-transport-only results and mixed results?</p>
</blockquote>
<p>In this case you need to currently send off two requests: Say, one with <code>modes=pt_pub</code> and one with <code>modes=pt_pub&amp;modes=ps_tax</code>.</p>
<p>We've done it this way as the mixed-modal can be a fair bit slower as the routing engine has more combinations too crunch and, typically, also depends on more external API calls, which slows things down further.</p>
<p>Requests that specify more than one mode will only return results which use at least two of the specified modes. That way you don't need to do duplicate detection between the single-modal and mixed-modal results.</p>
<hr />
<h2 id="trips-groups-frequencies-and-templates">Trips, groups, frequencies and templates</h2>
<blockquote>
<p>What is the logic behind trip groups and what does the frequency property mean?</p>
</blockquote>
<p>Each group is one way of getting from A to B. Each trip in a group is taking the same modes, and similar stops and tickets. They can take different services and different platforms, but overall they are all the same way of getting where you want to go, just at different times.</p>
<p>Frequency is related to this. It's the average frequency for how often such trips in a group run. It's an indication of how long you'd need to wait if you missed a trip in that group.</p>
<p>In our UI, for showing alternative ways of getting from A to B, we display a list of trip groups and for each trip group we display a "representative" trip, which is the one that fits the query the best. That's the trip in the trip group with the lowest <code>weightedScore</code>.</p>
<blockquote>
<p>Why are segments split into references and templates?</p>
</blockquote>
<p>This is related to trip groups: Trips in those groups often vary in just a few components but often take the same way or share other properties. The shared properties live in the templates while the properties that typically vary between trips live in the references. This can significantly cut down the size of the results and, thus, also the parsing speed on the client.</p>
<hr />
<h2 id="placeholders-in-segment-templates">Placeholders in segment templates</h2>
<blockquote>
<p>What are all the possible values for placeholders and how should they get interpreted?</p>
</blockquote>
<p>In order to use segment templates for multiple similar segments, the <code>notes</code> and <code>action</code> fields of a segment templates use placeholders, which should be filled it at run-time with the information from the segment template, and potentially updated with real-time data.</p>
<ul>
<li><code>&lt;NUMBER&gt;</code>: Placeholder for the number of short name of the transit service, e.g., <code>segment.serviceNumber</code>.</li>
<li><code>&lt;LINE_NAME&gt;</code>: Placeholder for the long name of the transit service, e.g., <code>segment.serviceName</code>.</li>
<li><code>&lt;DIRECTION&gt;</code>: Placeholder for the direction of the transit service, e.g., <code>segment.serviceDirection</code>.</li>
<li><code>&lt;LOCATIONS&gt;</code>: Placeholder for the start and end location of the segment, e.g., <code>segment.start -&gt; segment.end</code>.</li>
<li><code>&lt;PLATFORM&gt;</code>: Placeholder for the embarkation platform of the transit service, e.g., <code>segment.platform</code>.</li>
<li><code>&lt;STOPS&gt;</code>: Placeholder for the number of stops that a transit service takes from the start to the end of the segment (including the disembarkation, but excluding the embarkation stop), e.g., <code>segment.stops</code>.</li>
<li><code>&lt;TIME&gt;</code>*: Placeholder for the departure time of the segment, e.g., <code>segment.startTime</code> formatted as a time. Note that this can directly follow a <code>&lt;NUMBER&gt;</code> template, so you might have to add spacing. </li>
<li><code>&lt;DURATION&gt;</code>*: Placeholder for the total duration of the segment, e.g., <code>segment.endTime - segment.startTime</code> formatted as a duration string.</li>
<li><code>&lt;TRAFFIC&gt;</code>: (Badly named) placeholder for the total duration <em>without</em> traffic of the segment, e.g., <code>segment.durationWithoutTraffic</code> formatted as a duration string.</li>
</ul>
<p><code>*</code>: Should be updated with real-time data.</p>
<hr />
<h1 id="locations">Locations</h1>
<h2 id="locations-cell-ids-and-hash-codes">Locations, cell IDs and hash codes</h2>
<blockquote>
<p>What are the cell IDs in the <code>locations.json</code> endpoint?</p>
</blockquote>
<p>The way map regions are specified takes a bit of getting used to but it's worth it, as it allows caching results on the client, while frequently calling this endpoint to make sure the local data is update without requiring a lot of data overhead (and having most of the logic on the server). This works by splitting the world into individual cells which get an identifier which represents the south-west corner as <code>$(lat*cellsPerDegree)#$(lng*cellsPerDegree)</code>.</p>
<blockquote>
<p>Got it. And <code>cellIDHashCodes</code>?</p>
</blockquote>
<p>You typically call <code>locations.json</code> with the cell IDs, but if you want to cache this information on the client, then, later, you'll want to use <code>cellIDHashCodes</code> as the input. Here you, again, send the cell IDs but this time with the hash codes for each cell from the previous output. You'll then only get content for cells if their content changed.</p>
<hr />
<h3 id="example">Example</h3>
<p>Let's say, you want the minor stops around CBD of Sydney, Australia. You'll first request:</p>
<pre><code>{
  "region": "AU_NSW_Sydney",
  "level": 2,
  "cellIDs": [
    "-2540#11339",
    "-2540#11340",
    "-2540#11341",
    "-2541#11339",
    "-2541#11340",
    "-2541#11341",
    "-2542#11339",
    "-2542#11340",
    "-2542#11341"
  ]
}
</code></pre>
<p>You'll then get results:</p>
<pre><code>{
  "groups": [
    {
      "hashCode": 690784261,
      "key": "-2540#11339",
      "stops": [...]
    },
    {
      "hashCode": -1940969928,
      "key": "-2540#11340",
      "stops": [...]
    }
  ]
}
</code></pre>
<p>You can then cache these and later on request again for changes by supplying <code>cellIDHashCodes</code>:</p>
<pre><code>{
  "region": "AU_NSW_Sydney",
  "level": 2,
  "cellIDHashCodes": {
    "-2540#11339": 690784261,
    "-2540#11340": -1940969928
  }
}
</code></pre>
<p>Which will then only return any groups that have changed. If nothing changed, you'll just get back:</p>
<pre><code>{
  "groups": []
}
</code></pre>
<hr />
<p><strong>Note</strong>: You can do the same thing for the major stations of level 1. In that case the cell ID is typically the code of the region itself:</p>
<pre><code>{
  "region": "AU_NSW_Sydney",
  "cellIDHashCodes": {
    "AU_NSW_Sydney": 1096794422
  }
}
</code></pre></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script>
        <script>var base_url = '..';</script>
        <script data-main="../mkdocs/js/search.js" src="../mkdocs/js/require.js"></script>
        <script src="../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
